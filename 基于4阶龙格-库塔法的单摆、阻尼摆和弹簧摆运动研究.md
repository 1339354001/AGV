## <center>基于4阶龙格-库塔法的广角单摆、阻尼摆和弹簧摆运动研究</center>

<center>许佳阳 3210103789</center>

#### 问题背景

​	单摆是我们在日常生活中所能见到的一中常见的物理模型，一个带有质量的小球在一根摆线的连接与一个固定点连接，小球初始静止，并且摆线绷直，摆线与竖直方向存在一定夹角。在摆线拉力和重力的作用下，小球开始在水平面中做来回的周期性摆动。

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230429185254748.png" alt="image-20230429185254748" style="zoom:80%;" />

​	当摆角小于5°时，往往可以将运动视作一个简谐振动，从而根据惠根斯的单摆周期公式，可以计算出单摆的周期。
$$
\frac{d^2\theta(t)}{dt^2}\approx -\frac{g}{l}\theta(t)\\
T = 2\pi \sqrt{\frac{L}{g}}
$$

​	但事实上，只要摆角大于5°，就无法近似为一个简谐运动，要解析这个运动就必须通过解微分方程或者进行数值求解。此外，在现实的生活中，空气阻力是除了重力之外另一种几乎无法克服的外力，因此，在单摆运动中，实际上也必须考虑空气阻尼的影响。另外，在一般认知中，人们往往将摆线的认为是无弹性的绳子，但在现实生活中，实际上很多摆线是有弹性的，并且其劲度系数不可以被忽略，因此在单摆的基础上，对具有具有劲度系数的弹簧摆进行一定的研究也具有很重要的意义。随着空气阻力和摆线的劲度系数这些因素的加入，整个模型开始变得复杂起来，但是也越来越具有现实意义。虽然通过求解微分方程的方法已经无法求解复杂化之后的这些摆动模型，但是根据一些数值微分的计算方法，还是可以很好的近似与解析这些运动的。本报告就将基于四节龙格-库塔法来对这些运动进行数值求解。



#### 建模分析

​	在摆动模型中，摆线的虽然具有质量，但其质量和小球相比的话是几乎可以忽略的，因此，对小球取质心即可将该现实模型简化为一个质点系的模型，从而让计算难度大大降低。

​	假设固定点到小球的距离（摆绳长）为l，小球半径为r，固定点到小球中心的距离（摆长）为L，重力加速度为g，小球质量为m，扬起的角度对时间的函数为θ(t)，空气密度为ρ，空气阻力系数为C，摆线劲度系数为k。

##### 广角单摆

​	对于一个广角单摆来说，其不能近似为简谐振动。首先根据受力，可以写出其受力方程。
$$
F_{切向}=-mg\sin(\theta(t))\\
F_{切向}=ma=m\frac{d^2v_{切向}(t)}{dt^2}=mL\frac{d^2\theta(t)}{dt^2}
$$
​	从而可以得出如下的运动微分方程。
$$
\frac{d^2\theta(t)}{dt^2}=-\frac{g}{L}\sin(\theta(t))
$$
##### 阻尼摆

​	对于阻尼摆动而言，空气阻力的大小与投影面积和速度的平方都成正比。因此在这里计算空气阻力时，不能将摆球视作是一个质点。
$$
f\approx-\frac{1}{2}\rho C \pi r^2v^2=-\frac{1}{2}\rho C \pi r^2v|v|=-\frac{1}{2}\rho C \pi r^2\omega|\omega|L^2,注：此处的v与\omega均为矢量，正负存在方向
$$
​	根据以上的摆球运动中的阻力公式可以发现，空气阻力的方向始终与运动方向相反，并且由于运动速度始终是切向的，因此阻力也是切向的。

​	从而我们可以推到出如下受力方程。
$$
F_{切向}=-mg\sin{\theta(t)}+f=-mg\sin{\theta(t)}-\frac{1}{2}\rho C \pi r^2\omega|\omega|=-mg\sin{\theta(t)}-\frac{1}{2}\rho C \pi r^2\frac{d\theta(t)}{dt}|\frac{d\theta(t)}{dt}|
$$
​	从而得到如下的微分方程。
$$
\frac{d^2\theta(t)}{dt^2}=-\frac{g}{L}\sin{(\theta(t))}-\frac{1}{2m}\rho C \pi r^2\frac{d\theta(t)}{dt}|\frac{d\theta(t)}{dt}|L
$$

##### 弹簧摆

​	对于弹簧摆而言，摆线的劲度系数k不再能视为无穷大，并且这一运动与前面两个单摆运动最大的差别就是，该运动的速度不再被限制在切线方向。由于摆线（可认为是一个弹簧）的弹性力作用，小球在运动过程中将会产生法向的运动速度，。运动速度不仅仅局限于法向的最明显特征就是，再也无法用一个微分方程来描述这个运动了，必须使用一个二维方程组来描述这个运动，从而让整个运动模型变得十分复杂。

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430003529146.png" alt="image-20230430003529146" style="zoom:50%;" />

​	此外，该模型的推导需要用到一些偏微分与理论力学的知识，但最终还是可以归结为两个与小球有关的常微分方程。我在学习了一些必要的数理方法知识之后，根据欧拉-拉格朗日方程推导出了这个运动的运动微分方程组。

​	首先对将这个物理模型放到直角坐标系中，以竖直平衡位置为原点，竖直向下为y轴正方向，水平向右为x轴正方向。接着，计算出数值方向的平衡位置处的摆长
$$
L=L_0+\frac{mg}{k},L_0为无弹性时的摆长
$$

​	假设摆长的函数为r(t)，在x和y方向上可以根据位移可以列写如下方程组：
$$
x = r(t)\sin{(\theta(t))}\\
y = r(t)\cos{(\theta(t))}-L=r(t)\cos{(\theta(t))}-L_0-\frac{mg}{k}
$$
​	对该方程组进行求导，从而可以得到速度的微分方程组：
$$
v_x = \frac{dr(t)}{dt}\sin{(\theta(t))}+r(t)\cos{(\theta(t))}\frac{d\theta(t)}{dt}   \\
v_y = \frac{dr(t)}{dt}\cos(\theta(t))-r(t)\sin{(\theta(t))}\frac{d\theta(t)}{dt} 
$$
​	从而可以计算出势能和动能
$$
E_k=\frac{1}{2}m(v_x^2+v_y^2)=\frac{1}{2}m((\frac{dr(t)}{dt})^2+r^2(t)(\frac{d\theta(t)}{dt})^2) \\
E_p=\frac{k}{2}(r(t)-L)^2+mg(L-y)=\frac{k}{2}(r(t)-L)^2-mgr(t)\cos{(\theta(t))}
$$
​	根据欧拉-拉格朗日方程：
$$
\frac{d}{dt} \frac{\partial E_k}{\partial r'}-\frac{\partial E_k}{\partial r}+\frac{\partial E_p}{\partial r}=0\\
\frac{d}{dt} \frac{\partial E_k}{\partial \theta'}+\frac{\partial E_p}{\partial \theta}=0
$$
​	从而得到：
$$
r(t)''+\frac{k}{m}(r(t)-l_0-\frac{mg}{k})-r(t) (\theta(t)')^2-g\cos{(\theta(t))}=0
\\
\theta(t)''+\frac{2}{r(t)}r(t)'\theta(t)'+\frac{g}{r(t)}\sin{(\theta(t))}=0
$$
​	进而转化为
$$
\frac{d^2r(t)}{dt^2} = -\frac{k}{m}(r(t)-l_0-\frac{mg}{k})+r(t) (\frac{dr(t)}{dt})^2+g\cos{(\theta(t))}
\\
\frac{d^2\theta(t)}{dt^2}=-\frac{2}{r(t)}\frac{dr(t)}{dt}\frac{d\theta(t)}{dt}-\frac{g}{r(t)}\sin{(\theta(t))}
$$


#### 算法设计

##### 4阶龙格-库塔法的计算函数

​	龙格-库塔法是一类用于数值求解常微分方程初值问题的方法。它们通过对微分方程在每个时间步长内的逼近值进行加权平均，以提高计算精度。

​	

​	四阶龙格-库塔法是一种用于数值求解常微分方程初值问题的方法。它是龙格-库塔法中最常用且广泛应用的一种。四阶龙格-库塔法在求解过程中使用了4个阶段的逼近来获得更高的计算精度。给定一个常微分方程和初始条件：
$$
\frac{dy}{dx}=f(x,y)，y(x_0)=y_0
$$
​	将区间分成一个数量的等长区间，每个区间长为h，通过前一个区间的平均y值，可以估计后一个区间的平均y值，公式如下：
$$
y_{i+1}=y_{i}+\frac{1}{6}(k_1+2k_2+2k_3+k_4)\\
其中：k_1=h \cdot f(x_i,y_i)\\k_2=h\cdot f(x_i+\frac{h}{2},y_i+\frac{k_1}{2})\\
k_3=h\cdot f(x_i+\frac{h}{2},y_i+\frac{k_2}{2})\\k_4=h\cdot f(x_i+h,y_i+k_3)
$$
​	该计算方法在高阶的微分方程组下也同样适用，不过需要对微分方程进行一定的变形，将最高阶的导数放在一边。。

​	本题主要涉及4阶的龙格-库塔法，此外由于弹簧摆涉及的是常微分方程组，所以在设计算法时必须考虑这个算法是否适用于常微分方程组。

​	首先由于设计函数接口，考虑到进行四阶龙格-库塔法的计算需要常微分方程、定义区间、小区间长度和初始条件，而输出的值是定义区间矩阵和数值求解矩阵。因此，函数的接口可以定义为

```matlab
function [t, y] = rk4(f, tspan, y0, dt)
% f 为常微分方程
% tspan为定义区间
% y0为初始条件
% dt为小区间长度
```

​	在这四个参数中，主要考虑代表常微分方程（组）的f如何定义构建。可以考虑用一个一维的举证来表达f，按照先写微分方程左侧，再写右侧的规则来进行输入。以广度单摆为例，可以用函数句柄来表达

```matlab
f = @(t, y) [y(2); -g/L*sin(y(1))];
% 其中y(1)表示角度θ，y(2)表示角速度w
```

​	接着，我们继续考虑如何实践4阶龙格-库塔法。接下来相对定义区间tspan按照区间长度h进行离散化，并对输出结果[t, y]进行初始化。

```matlab
    t = tspan(1):dt:tspan(2);% 离散化的输出区间
    n = length(t);% 区间内的小区间个数
    y = zeros(n, length(y0));% 创建输出结果y
    y(1, :) = y0;% y的第1行为初始条件
```

​	随后利用一个循环语句来对y矩阵进行更新。

```matlab
    % 4阶龙格库塔计算
    for i = 1:(n-1)
        % 计算四个参数
        k1 = f(t(i), y(i, :))';% 计算k1并进行转置
        k2 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k1)';% 计算k2并进行转置
        k3 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k2)';% 计算k3并进行转置
        k4 = f(t(i) + dt, y(i, :) + dt*k3)';% 计算k4并进行转置
        % 更新下一个y
        y(i+1, :) = y(i, :) + (1/6)*(k1 + 2*k2 + 2*k3 + k4)*dt;
    end
```

​	值得注意的是，该程序是可以对常微分方程组进行计算的，因此具有泛用性。

##### 广角单摆运动

​	根据前面的建模和设计，首先定义与计算初始的条件

```matlab
% 定义系统的常数
g = 9.81; % 重力加速度(m/s^2)
L = 1; % 摆长(m)
m = 1; % 摆球质量(kg)
theta0 = pi/4; % 初始摆角(rad)
omega0 = 0; % 初始角速度(rad/s)

% 定义时间区间和单位区间长度
tspan = [0 100];
dt = 0.01;

% 输入初始情况
y0 = [theta0; omega0];
```

​	随后设定常微分方程

```matlab
% 定义常微分方程
f = @(t, y) [y(2); -g/L*sin(y(1))];% y(1)为角度，y(2)为角速度
```

​	然后将方程和有关参数放入到rk4()函数中进行计算，得出结果后对结果进行可视化。

```matlab
% 进行4阶龙格-库塔法数值微分求解
[t, y] = rk4(f, tspan, y0, dt);

% 提取角度和角速度
theta = y(:, 1);
omega = y(:, 2);

% 计算直角坐标
x = L*sin(theta);
y = -L*cos(theta);

% 可视化
% 输出角度随时间的图像
subplot(2, 1, 1);
plot(t, theta);
xlabel('Time (s)');
ylabel('Angle (rad)');
title('Angle - Time');

% 输出角速度随时间的图像
subplot(2, 1, 2);
plot(t, omega);
xlabel('Time (s)');
ylabel('Angular Velocity (rad/s)');
title('Angular Velocity - Time');



% 输出摆球运动轨迹
figure;
plot(x, y);
xlabel('Horizontal Position (m)');
ylabel('Vertical Position (m)');
title('Trajectory of Pendulum Ball');

% 龙格-库塔法
function [t, y] = rk4(f, tspan, y0, dt)
    t = tspan(1):dt:tspan(2);% 离散化的输出区间
    n = length(t);% 区间内的小区间个数
    y = zeros(n, length(y0));% 创建输出结果y
    y(1, :) = y0;% y的第1行为初始条件
    
    % 4阶龙格库塔计算
    for i = 1:(n-1)
        % 计算四个参数
        k1 = f(t(i), y(i, :))';
        k2 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k1)';
        k3 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k2)';
        k4 = f(t(i) + dt, y(i, :) + dt*k3)';
        % 更新下一个y
        y(i+1, :) = y(i, :) + (1/6)*(k1 + 2*k2 + 2*k3 + k4)*dt;
    end
end
```

##### 阻尼摆运动

​	阻尼摆的思路与广角单摆一致，在确定初始参数之后，对常微分方程进行设定。本模型的常微分方程的函数句柄如下：

```matlab
% 定义常微分方程   
f = @(t, y) [y(2); -g/l*sin(y(1)) - 0.5*rho*C*pi*R^2/m*norm(y(2))*y(2)*(l+R)];% y(1)为角度，y(2)为角速度
```

​	其余部分与广角单摆一致几乎一致，具体代码如下。

```matlab
close all; clc; clear;
% 定义系统的常数
g = 9.81; % 重力加速度(m/s^2)
l = 1; % 摆线长度(m)
m = 1; % 摆球质量(kg)
R = 0.1; % 摆球半径(m)
rho = 1.2; % 空气密度(kg/m^3)
C = 0.5; % 空气阻力系数
theta0 = pi/4; % 初始摆角(rad)
omega0 = 0; % 初始角速度(rad/s)

% 定义时间区间和单位区间长度
tspan = [0 100];
dt = 0.01;

% 输入初始情况
y0 = [theta0; omega0];

% 定义常微分方程   
f = @(t, y) [y(2); -g/l*sin(y(1)) - 0.5*rho*C*pi*R^2/m*norm(y(2))*y(2)*(l+R)];% y(1)为角度，y(2)为角速度

% 进行4阶龙格-库塔法数值微分求解
[t, y] = rk4(f, tspan, y0, dt);

% 提取角度和角速度
theta = y(:, 1);
omega = y(:, 2);

% 计算直角坐标
x = l*sin(theta);
y = -l*cos(theta);

% 可视化
% 输出角度随时间的图像
subplot(2, 1, 1);
plot(t, theta);
xlabel('Time (s)');
ylabel('Angle (rad)');
title('Angle - Time');

% 输出角速度随时间的图像
subplot(2, 1, 2);
plot(t, omega);
xlabel('Time (s)');
ylabel('Angular Velocity (rad/s)');
title('Angular Velocity - Time');

% 输出摆球运动轨迹
figure;
plot(x, y);
xlabel('Horizontal Position (m)');
ylabel('Vertical Position (m)');
title('Trajectory of Pendulum Ball');

% 龙格-库塔法
function [t, y] = rk4(f, tspan, y0, dt)
    t = tspan(1):dt:tspan(2);% 离散化的输出区间
    n = length(t);% 区间内的小区间个数
    y = zeros(n, length(y0));% 创建输出结果y
    y(1, :) = y0;% y的第1行为初始条件

    % 4阶龙格库塔计算
    for i = 1:(n-1)
        % 计算四个参数
        k1 = f(t(i), y(i, :))';
        k2 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k1)';
        k3 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k2)';
        k4 = f(t(i) + dt, y(i, :) + dt*k3)';
        % 更新下一个y
        y(i+1, :) = y(i, :) + (1/6)*(k1 + 2*k2 + 2*k3 + k4)*dt;
    end
end
```



##### 弹簧摆运动

​	弹簧摆最显著的特征就是要设定一个常微分方程组，而不是仅仅一个常微分方程。其常微分方程组的函数句柄如下：

```matlab
% 定义常微分方程
f = @(t, y) [y(3); y(4); -k/m*(y(1)-L0-m*g/k)-y(1)*y(4)^2+g*cos(y(2)); -2*y(3)*y(4)/y(1)-g*sin(y(2))/y(1)];
% y(1)为摆长，y(2)为角度，y(3)为法向速度，y(4)为角速度
```

​	其余部分的思路与另外两个模型几乎一样，代码如下。

```matlab
close all; clc; clear;
% 定义系统的常数
g = 9.81; % 重力加速度(m/s^2)
m = 1; % 摆球质量(kg)
k = 100; % 劲度系数(N/m)
L0 = 1; % 摆长(m)
v0 = 2; % 小球在平衡位置处的速度(m/s)

% 计算初始情况
r0 = L0 + m * g / k;
theta0 = 0;
dr0 = 0;
dtheta0 = v0 / r0;

% 定义时间区间和单位区间长度
tspan = [0, 100];
dt = 0.01;

% 输入初始情况
y0 = [r0; theta0; dr0; dtheta0];

% 定义常微分方程
f = @(t, y) [y(3); y(4); -k/m*(y(1)-L0-m*g/k)-y(1)*y(4)^2+g*cos(y(2)); -2*y(3)*y(4)/y(1)-g*sin(y(2))/y(1)];
% y(1)为摆长，y(2)为角度，y(3)为法向速度，y(4)为角速度

% 进行4阶龙格-库塔法数值微分求解
[t, y] = rk4(f, tspan, y0, dt);

% 提取摆长、法向速度、角度、角速度和切向速度
r = y(:, 1);
theta = y(:, 2);
vn = y(:, 3);
w = y(:, 4);
vt = w.*r;

% 计算直角坐标
x = r .* sin(theta);
y = -r .* cos(theta);

% 输出摆长随时间的图像
figure;
subplot(2, 1, 1);
plot(t, r);
xlabel('Time (s)');
ylabel('Pendulum Length (m)');
title('Pendulum Length - Time');

% 输出法向线速度随时间的图像
subplot(2, 1, 2);
plot(t, vn);
xlabel('Time (s)');
ylabel('Normal Velocity (m/s)');
title('Normal Velocity - Time');

% 输出角度随时间的图像
figure;
subplot(2, 1, 1);
plot(t, theta);
xlabel('Time (s)');
ylabel('Angle (rad)');
title('Angle - Time');

% 输出角速度随时间的图像
subplot(2, 1, 2);
plot(t, w);
xlabel('Time (s)');
ylabel('Angular Velocity (rad/s)');
title('Angular Velocity - Time');

% 输出切向速度随时间的图像
figure;
subplot(2, 1, 1);
plot(t, vt);
xlabel('Time (s)');
ylabel('Tangential Velocity (m/s)');
title('Tangential Velocity - Time');

% 输出摆球运动轨迹
figure;
plot(x, y);
xlabel('Horizontal Position (m)');
ylabel('Vertical Position (m)');
title('Trajectory of Spring Pendulum');

% 龙格-库塔法
function [t, y] = rk4(f, tspan, y0, dt)
    t = tspan(1):dt:tspan(2);% 离散化的输出区间
    n = length(t);% 区间内的小区间个数
    y = zeros(n, length(y0));% 创建输出结果y
    y(1, :) = y0;% y的第1行为初始条件

    % 4阶龙格库塔计算
    for i = 1:(n-1)
        % 计算四个参数
        k1 = f(t(i), y(i, :))';
        k2 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k1)';
        k3 = f(t(i) + 0.5*dt, y(i, :) + 0.5*dt*k2)';
        k4 = f(t(i) + dt, y(i, :) + dt*k3)';
        % 更新下一个y
        y(i+1, :) = y(i, :) + (1/6)*(k1 + 2*k2 + 2*k3 + k4)*dt;
    end
end
	
```

#### 运行结果

##### 广角单摆

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430004841109.png" alt="image-20230430004841109" style="zoom:67%;" />

##### 阻尼摆

* 空气阻力大（阻尼系数大，C=2）

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430005101615.png" alt="image-20230430005101615" style="zoom:67%;" />

* 空气阻力小（阻尼系数小，C=0.5）

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430005026267.png" alt="image-20230430005026267" style="zoom:67%;" />

##### 弹簧摆

* 劲度系数较小（k=100 N/m）

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430005729633.png" alt="image-20230430005729633" style="zoom:67%;" />

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430005808433.png" alt="image-20230430005808433" style="zoom:67%;" />

* 劲度系数较大（k=1000 N/m）

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430005853444.png" alt="image-20230430005853444" style="zoom:67%;" />

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430005936489.png" alt="image-20230430005936489" style="zoom:67%;" />

#### 结果分析

##### 广角单摆

​	根据运行结果可以发现，广角单摆虽然不再能被近似为一个简谐运动，但是其角度和角速度的变化规律仍然出周期性的波动规律。并且摆角的最大值和角速度的最大值一直保持不变。

##### 阻尼摆

​	随着时间的运行，可以发现角度和角速度的图像的简单包络线总的而言是越来越窄的，即在阻尼的作用下，该物理模型的能量在逐渐损耗。当空气阻力系数较小的时候，系统的能量损失较慢，最大摆角和最大角速度也下降较慢；当空气阻力系数较大的时候，系统的能量损失较快，最大摆角和最大角速度也下降较快。

##### 弹簧摆

​	弹簧摆的运动模型十分复杂，这是因为其运动的微分方程组一般是没有解析解的。当劲度系数较大时，这种混沌的现象极为明显，观察运行结果中的运动轨迹就可以发现，其运动轨迹没有十分明显的周期性。但是当劲度系数较大时，摆线可以逐渐被认为在绷直的情况下是刚性的，其运动轨迹也越来越与普通的广角单摆的运动轨迹接近，其角度、角速度、摆长、法向速度和切线速度的最大值的波动性的越来越小，越来越与普通广角单摆的这些参数相近。

##### 小结

​	本报告选择了三种最有代表性的摆动（广角单摆、阻尼摆和弹簧摆）作为研究对象，利用精确度较高的4阶龙格-库塔法作为计算方法来进行数值求解。

​	但在实际计算中，本题也遇到了一些问题，如弹簧摆模型中，如果将平衡位置速度设置的较大，就会让程序的求解出现巨大的误差，如下图（此时v0=20）。

<img src="C:\Users\13393\AppData\Roaming\Typora\typora-user-images\image-20230430012443193.png" alt="image-20230430012443193" style="zoom:67%;" />

造成这种现象的原因主要是数据数量级过大，而平均区间长度和计算方法的准确度开始逐渐无法匹配较大数量级的计算，从而使得绝对误差大大上升。解决这个问题可以采用以下方法：1.选用更高阶的龙格-库塔法，提高算法的计算精度；2.减小单位小区间的长度，即增加区间密度。

​	假以更多的时间，还将对更复杂的摆动问题和较大数据下的误差问题等进行解决。

​	最后感谢老师和助教一个学期起来的帮助与指导。



















